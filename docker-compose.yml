# Docker Compose for local development
# Note: For production deployment on Render.com, services (PostgreSQL, Redis, Kafka) 
# should be provisioned separately and connected via environment variables

services:
  backend:
    build: .
    container_name: skillstream-backend
    restart: always
    env_file:
      - .env
    ports:
      - "3000:3000"
    # Removed depends_on - services will be provided externally on Render
    command: npm run dev
    volumes:
      - .:/usr/src/app
      - /usr/src/app/node_modules

  # Optional: Local development services (commented out for Render deployment)
  # Uncomment these if you want to run services locally for development
  # postgres:
  #   image: postgres:15
  #   container_name: skillstream-postgres
  #   restart: always
  #   environment:
  #     POSTGRES_USER: skillstream
  #     POSTGRES_PASSWORD: password
  #     POSTGRES_DB: skillstream
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data

  # zookeeper:
  #   image: bitnami/zookeeper:3.9
  #   container_name: zookeeper
  #   environment:
  #     - ALLOW_ANONYMOUS_LOGIN=yes
  #   ports:
  #     - "2181:2181"

  # kafka:
  #   image: bitnami/kafka:3.7
  #   container_name: kafka
  #   depends_on:
  #     - zookeeper
  #   ports:
  #     - "9092:9092"
  #     - "29092:29092"
  #   environment:
  #     - KAFKA_BROKER_ID=1
  #     - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
  #     - KAFKA_LISTENERS=PLAINTEXT://:9092,PLAINTEXT_HOST://:29092
  #     - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
  #     - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
  #     - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
  #     - ALLOW_PLAINTEXT_LISTENER=yes

  # redis:
  #   image: redis:7
  #   container_name: skillstream-redis
  #   ports:
  #     - "6379:6379"
  #   restart: always
  #   environment:
  #     REDIS_PASSWORD: myStrongPassword

# volumes:
#   pgdata: